== Core

[[core]]

This clause establishes the *Core* requirements class, with IRI `/req/core`, which has a single corresponding conformance class, *Core*, with IRI `/conf/core`. This requirements class defines a set of classes and properties for representing geospatial data. The resulting vocabulary - an ontology - can be used to construct SPARQL graph patterns for querying appropriately modeled geospatial data. The RDFS and OWL vocabularies have both been used so that the vocabulary can be understood by systems that support only RDFS entailment and by systems that support OWL-based reasoning.

The figure below gives an overview of the classes and properties defined by GeoSPARQL in the *Core*, *Topology Vocabulary Extension* and *Geometry Extension*, *Geometry Topology Extension* and *RDFS Entailment Extension* Conformance Classes. 

[#ont-classes]
.An overview of GeoSPARQL's Classes and their main relations.
image::figures/classes.png[GeoSPARQL Ontology overview,align="center"]

[requirements_class,identifier="/req/core",subject="Implementation Specification"]
.Core Extension
====
requirement:: /req/core/sparql-protocol
requirement:: /req/core/spatial-object-class
requirement:: /req/core/feature-class
requirement:: /req/core/spatial-object-collection-class
requirement:: /req/core/feature-collection-class
requirement:: /req/core/geometry-collection-class
requirement:: /req/core/spatial-object-properties
====

[[sparql_protocol]]
=== SPARQL

[[req_core_sparql-protocol]]
[requirement,identifier="/req/core/sparql-protocol",abstract-test="/conf/core/sparql-protocol"]
.SPARQL Protocol
====
Implementations shall support the SPARQL Query Language for RDF <<SPARQL>>, the SPARQL Protocol <<SPARQLPROT>> and the SPARQL Query Results XML <<SPARQLRESX>> and JSON <<SPARQLRESJ>> Formats.
====

=== Classes

Two main classes are defined: <<class-spatialobject, `Spatial Object`>> and <<class-feature, `Feature`>>. The class <<class-feature, `Feature`>> is equivalent to the UML class `Feature` defined in <<ISO19109>>.

Two container classes are defined: <<class-spatialobjectcollection, `SpatialObjectCollection`>> and <<class-featurecollection, `FeatureCollection`>>.

[[class-spatialobject]]
==== SpatialObject

The class <<class-spatialobject, `SpatialObject`>> is defined by the following:

[%unnumbered]
[source,turtle]
----
geo:SpatialObject 
    a rdfs:Class, owl:Class ;
    rdfs:isDefinedBy geo: ;
    skos:prefLabel "Spatial Object"@en ;
    skos:definition "Anything spatial (being or having a shape, position or an extent)."@en ;
    skos:note "Subclasses of this class are expected to be used for instance data."@en ;
.
----
[[req_core_spatial_object_class]]
[requirement,identifier="/req/core/spatial-object-class"]
.Spatial Object Class
==== 
Implementations shall allow the RDFS class <<class-spatialobject, `SpatialObject`>> to be used in SPARQL graph patterns.
====

*Example:*

[%unnumbered]
[source,turtle]
----
eg:x 
    a geo:SpatialObject ;
     skos:prefLabel "Object X";
.
----

[[class-feature]]
==== Feature

The class <<class-feature, `Feature`>> is equivalent to the class `GFI_Feature` <<ISO19156>> and is defined by the following:

[%unnumbered]
[source,turtle]
----
geo:Feature 
    a rdfs:Class, owl:Class ;
    rdfs:isDefinedBy geo: ;
    skos:prefLabel "Feature"@en ;
    rdfs:subClassOf geo:SpatialObject ;
    owl:disjointWith geo:Geometry ;
    skos:definition "A discrete spatial phenomenon in a universe of discourse."@en ;
    skos:note "A Feature represents a uniquely identifiable phenomenon, for example 
              a river or an apple. While such phenomena (and therefore the Features 
              used to represent them) are bounded, their boundaries may be crisp 
              (e.g., the declared boundaries of a state), vague (e.g., the 
              delineation of a valley versus its neighboring mountains), and change 
              with time (e.g., a storm front). While discrete in nature, Features 
              may be created from continuous observations, such as an isochrone 
              that determines the region that can be reached by ambulance within 
              5 minutes."@en ;
.
----

[[req_core_feature-class]]
[requirement,identifier="/req/core/feature-class"]
.Feature Class
====
Implementations shall allow the RDFS class <<class-feature, `Feature`>> to be used in SPARQL graph patterns.
====

[[class-spatialobjectcollection]]
==== SpatialObjectCollection

The class <<class-spatialobjectcollection, `SpatialObjectCollection`>> is defined by the following:

[%unnumbered]
[source,turtle]
----
geo:SpatialObjectCollection
    a owl:Class ;
    rdfs:isDefinedBy geo: ;
    skos:prefLabel "Spatial Object Collection" ;
    skos:definition "A collection of individual Spatial Objects."@en ;  
    skos:note "This is the superclass of Feature Collection and Geometry Collection."@en ;              
    rdfs:subClassOf rdfs:Container ;
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:allValuesFrom geo:SpatialObject ;
        owl:onProperty rdfs:member ;
    ] ;
.
----

Membership of the generic http://www.w3.org/2000/01/rdf-schema#Container[`rdfs:Container`] that defines this class is restricted to instances of <<class-spatialobject, `SpatialObject`>>. <<class-spatialobjectcollection, `SpatialObjectCollection`>> members are to be indicated with the http://www.w3.org/2000/01/rdf-schema#member[`rdfs:member`] property.

[[req_core_spatial-object-collection-class]]
[requirement,identifier="/req/core/spatial-object-collection-class"]
.Spatial Object Collection Class
====
Implementations shall allow the RDFS class <<class-spatialobjectcollection, `SpatialObjectCollection`>> to be used in SPARQL graph patterns.
====

[[class-featurecollection]]
==== FeatureCollection

The class <<class-featurecollection, `FeatureCollection`>> is defined by the following:

[%unnumbered]
[source,turtle]
----
geo:FeatureCollection
    a owl:Class ;
    rdfs:isDefinedBy geo: ;
    skos:prefLabel "Feature Collection" ;
    skos:definition "A collection of individual Features."@en ;
    rdfs:subClassOf geo:SpatialObjectCollection ;
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:allValuesFrom :Feature ;
        owl:onProperty rdfs:member ;
    ] ;
.
----

Membership of the more general <<class-spatialobjectcollection, `SpatialObjectCollection`>> that defines this class is restricted to instances of <<class-feature, `Feature`>>.  <<class-featurecollection, `FeatureCollection`>> members are to be indicated with the http://www.w3.org/2000/01/rdf-schema#member[`rdfs:member`] property.

[[req_core_feature-collection-class]]
[requirement,identifier="/req/core/feature-collection-class"]
.Feature Collection Class
====
Implementations shall allow the RDFS class <<class-featurecollection, `FeatureCollection`>> to be used in SPARQL graph patterns.
====

[[spatial-object-properties]]
=== Standard Properties for `SpatialObject`

Properties are defined for associating Spatial Objects with scalar spatial measurements (sizes) .

[[req_geometry-extension_spatial-object-properties]]
[requirement,identifier="/req/core/spatial-object-properties"]
.Spatial Object Properties
====
Implementations shall allow the properties 
<<prop-hassize, `hasSize`>>,
<<prop-hasmetricsize, `hasMetricSize`>>,
<<prop-haslength, `hasLength`>>, 
<<prop-hasmetriclength, `hasMetricLength`>>,
<<prop-hasperimeterlength, `hasPerimeterLength`>>, 
<<prop-hasmetricperimeterlength, `hasMetricPerimeterLength`>>, 
<<prop-hasarea, `hasArea`>>,
<<prop-hasmetricarea, `hasMetricArea`>>,
<<prop-hasvolume, `hasVolume`>> and
<<prop-hasmetricvolume, `hasMetricVolume`>>
to be used in SPARQL graph patterns.
====

[[prop-hassize]]
==== hasSize

The property http://www.opengis.net/ont/geosparql#hasSize[`hasSize`] is the superproperty of all properties that can be used to indicate the size of a Spatial Object in case (only) metric units (meter, square meter or cubic meter) cannot be used. If it is possible to express size in metric units, subproperties of <<prop-hasmetricsize, `hasMetricSize`>> should be used.
This property has no range specification. This makes it possible to use other vocabularies for expressions of size, for example, vocabularies for units of measurement or vocabularies for specifying measurement quality.

GeoSPARQL 1.1 defines the following subproperties of this property: 
<<prop-haslength, `hasLength`>>, 
<<prop-hasperimeterlength, `hasPerimeterLength`>>, 
<<prop-hasarea, `hasArea`>> and 
<<prop-hasvolume, `hasVolume`>>.

[%unnumbered]
[source,turtle]
----
geo:hasSize 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:domain geo:SpatialObject ;
	skos:definition "Subproperties of this property are used to indicate the size of a 
                    Spatial Object as a measurement or estimate of one or more dimensions 
                    of the Spatial Object's spatial presence."@en ;
	skos:prefLabel "has size"@en ;
.
----

[[prop-hasmetricsize]]
==== hasMetricSize

The property http://www.opengis.net/ont/geosparql#hasMetricSize[`hasMetricSize`] is the superproperty of all properties that can be used to indicate the size of a Spatial Object using metric units (meter, square meter or cubic meter). Using a subproperty of this property is the recommended way to specify size, because using a standard unit of length (meter) benefits data interoperability and simplicity. Subproperties of <<prop-hassize, `hasSize`>> can be used if more complex expressions are necessary, for example, if the unit of length cannot be converted to meter, or if additional data are needed to describe the measurement or estimate of size.

GeoSPARQL 1.1 defines the following subproperties of this property: 
<<prop-hasmetriclength, `hasMetricLength`>>, 
<<prop-hasmetricperimeterlength, `hasMetricPerimeterLength`>>, 
<<prop-hasmetricarea, `hasMetricArea`>> and 
<<prop-hasmetricvolume, `hasMetricVolume`>>.

[%unnumbered]
[source,turtle]
----
geo:hasMetricSize 
    a rdf:Property, owl:DatatypeProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:domain geo:SpatialObject ;
	rdfs:range xsd:double ;
	skos:definition "Subproperties of this property are used to indicate the size of a 
                    Spatial Object, as a measurement or estimate of one or more dimensions 
                    of the Spatial Object's spatial presence. Units are always metric 
                    (meter, square meter or cubic meter)."@en ;
	skos:prefLabel "has metric size"@en ;
.
----

[[prop-haslength]]
==== hasLength

The property http://www.opengis.net/ont/geosparql#hasLength[`hasLength`] can be used to indicate the length of a Spatial Object if it is not possible to use the property <<prop-hasmetriclength, `hasMetricLength`>>. It is a subproperty of <<prop-hassize, `hasSize`>>.

[%unnumbered]
[source,turtle]
----
geo:hasLength 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasSize ;
	rdfs:domain geo:SpatialObject ;    
	skos:definition "The length of a Spatial Object."@en ;
	skos:prefLabel "has length"@en ;
.
----

[[prop-hasmetriclength]]
==== hasMetricLength

The property http://www.opengis.net/ont/geosparql#hasMetricLength[`hasMetricLength`] can be used to indicate the length of a Spatial Object in meters (m). It is a subproperty of <<prop-hasmetricsize, `hasMetricSize`>>. This property can be used for Spatial Objects having one, two, or three dimensions.

[%unnumbered]
[source,turtle]
----
geo:hasMetricLength 
    a rdf:Property, owl:DatatypeProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasMetricSize ;
	rdfs:domain geo:SpatialObject ;
	rdfs:range xsd:double ;    
	skos:definition "The length of a Spatial Object in meters."@en ;
	skos:prefLabel "has length in meters"@en ;
.
----

[[prop-hasperimeterlength]]
==== hasPerimeterLength

The property http://www.opengis.net/ont/geosparql#hasPerimeterLength[`hasPerimeterLength`] can be used to indicate the length of the outer boundary of a Spatial Object if it is not possible to use the property <<prop-hasmetricperimeterlength, `hasMetricPerimeterLength`>>. It is a subproperty of <<prop-hassize, `hasSize`>>.

[%unnumbered]
[source,turtle]
----
geo:hasPerimeterLength
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasSize ;
	skos:definition "The length of the perimeter of a Spatial Object."@en ;
	skos:prefLabel "has perimeter length"@en ;
.
----

[[prop-hasmetricperimeterlength]]
==== hasMetricPerimeterLength

The property <<prop-hasmetricperimeterlength, `hasMetricPerimeterLength`>> can be used to indicate the length of the outer boundary of a Spatial Object in meters (m). It is a subproperty of <<prop-hasmetricsize, `hasMetricSize`>>. Circumference is considered a type of perimeter, so this property can be used for circular or curved objects too. This property can be used for Spatial Objects having two or three dimensions.

[%unnumbered]
[source,turtle]
----
geo:hasMetricPerimeterLength
    a rdf:Property, owl:DatatypeProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasMetricSize ;
	rdfs:domain geo:SpatialObject ;
	rdfs:range xsd:double ;    
	skos:definition "The length of the perimeter of a Spatial Object in meters."@en ;
	skos:prefLabel "has perimeter length in meters"@en ;
.
----

TIP: A consistency check can be applied to <<class-geometry, `Geometry`>> instances indicating both this property and the property <<prop-dimension, `dimension`>>: if supplied, the <<prop-dimension, `dimension`>> property's range value must be the literal integer 2 or 3. The following SPARQL query will return `true` if applied to a graph where this is not the case for all Geometries:

[%unnumbered]
[source,sparql]
----
    PREFIX geo: <http://www.opengis.net/ont/geosparql#>
    ASK 
    WHERE {
        ?g geo:hasMetricPerimeterLength ?p ;
           geo:dimension ?d .
            
        FILTER (?d < 2)
    }
----

[[prop-hasarea]]
==== hasArea

The property http://www.opengis.net/ont/geosparql#hasArea[`hasArea`] can be used to indicate the area of a Spatial Object if it is not possible to use the property <<prop-hasmetricarea, `hasMetricArea`>>. It is a subproperty of <<prop-hassize, `hasSize`>>.

[%unnumbered]
[source,turtle]
----
geo:hasArea
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasSize ;
	rdfs:domain geo:SpatialObject ;    
	skos:definition "The area of a Spatial Object."@en ;
	skos:prefLabel "has area"@en ;
.
----

[[prop-hasmetricarea]]
==== hasMetricArea

The property <<prop-hasmetricarea, `hasMetricArea`>> can be used to indicate the area of a Spatial Object in square meters (m^2^). It is a subproperty of <<prop-hasmetricsize, `hasMetricSize`>>. This property can be used for Spatial Objects having two or three dimensions.

[%unnumbered]
[source,turtle]
----
geo:hasMetricArea
    a rdf:Property, owl:DatatypeProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasMetricSize ;
	rdfs:domain geo:SpatialObject ;
	rdfs:range xsd:double ;    
	skos:definition "The area of a Spatial Object in square meters."@en ;
	skos:prefLabel "has area in meters"@en ;
.
----
TIP: A consistency check can be applied to <<class-geometry, `Geometry`>> instances indicating both this property and the property <<prop-dimension, `dimension`>>: if supplied, the <<prop-dimension, `dimension`>> property's range value must be the literal integer 2 or 3. The following SPARQL query will return `true` if applied to a graph where this is not the case for all Geometries:

[%unnumbered]
[source,sparql]
----
    PREFIX geo: <http://www.opengis.net/ont/geosparql#>

    ASK 
    WHERE {
        ?g geo:hasMetricArea ?a ;
           geo:dimension ?d .
            
        FILTER (?d < 2)
    }
----

[[prop-hasvolume]]
==== hasVolume

The property <<prop-hasvolume, `hasVolume`>> can be used to indicate the volume of a Spatial Object if it is not possible to use the property <<prop-hasmetricvolume, `hasMetricVolume`>>. It is a subproperty of <<prop-hassize, `hasSize`>>.

[%unnumbered]
[source,turtle]
----
geo:hasVolume
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf geo:hasSize ;
	rdfs:domain geo:SpatialObject ;    
	skos:definition "The volume of a three-dimensional Spatial Object."@en ;
	skos:prefLabel "has volume"@en ;
.
----

[[prop-hasmetricvolume]]
==== hasMetricVolume

The property <<prop-hasmetricvolume, `hasMetricVolume`>> can be used to indicate the volume of a Spatial Object in cubic meters (m^3^). It is a subproperty of <<prop-hasmetricsize, `hasMetricSize`>>. This property can be used for Spatial Objects having three dimensions.

[%unnumbered]
[source,turtle]
----
geo:hasMetricVolume
    a rdf:Property, owl:DatatypeProperty ;
    rdfs:isDefinedBy geo: ;
	rdfs:subPropertyOf :hasMetricSize ;
	rdfs:domain geo:SpatialObject ;
	rdfs:range xsd:double ;    
	skos:definition "The volume of a Spatial Object in cubic meters."@en ;
	skos:prefLabel "has area in meters"@en ;
.
----
TIP: A consistency check can be applied to <<class-geometry, `Geometry`>> instances indicating both this property and the property <<prop-dimension, `dimension`>>: if supplied, the property <<prop-dimension, `dimension`>> property's range value must be the literal integer 3. The following SPARQL query will return `true` if applied to a graph where this is not the case for all Geometries:

[%unnumbered]
[source,sparql]
----
    PREFIX geo: <http://www.opengis.net/ont/geosparql#>

    ASK 
    WHERE {
        ?g geo:hasMetricVolume ?v ;
           geo:dimension ?d .
            
        FILTER (?d != 3)
    }
----

[[feature_properties]]
=== Standard Properties for `Feature`

Properties are defined for associating <<class-feature, `Feature`>> instances with <<Geometry, `Geometry`>> instances.

[[req_geometry-extension_feature-properties]]
[requirement,identifier="/req/geometry-extension/feature-properties"]
.Feature Properties
====
Implementations shall allow the properties 
<<prop-hasgeometry, `hasGeometry`>>, 
<<prop-hasdefaultgeometry, `hasDefaultGeometry`>>, 
<<prop-hascentroid, `hasCentroid`>> and 
<<prop-hasboundingbox, `hasBoundingBox`>>
to be used in SPARQL graph patterns.
====

[[prop-hasgeometry]]
==== hasGeometry

The property <<prop-hasgeometry, `hasGeometry`>> is used to link a Feature with a Geometry that represents its spatial extent. A given Feature may have many associated geometries.

[%unnumbered]
[source,turtle]
----
geo:hasGeometry 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
    rdfs:domain geo:Feature ;
    rdfs:range geo:Geometry ;    
    skos:prefLabel "has Geometry"@en ;
    skos:definition "A spatial representation for a given Feature."@en ;
.
----

[[prop-hasdefaultgeometry]]
==== hasDefaultGeometry

The property <<prop-hasdefaultgeometry, `hasDefaultGeometry`>> is used to link a Feature with its default Geometry. The default geometry is the Geometry that should be used for spatial calculations in the absence of a request for a specific geometry (e.g. in the case of query rewrite).

[%unnumbered]
[source,turtle]
----
geo:hasDefaultGeometry 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
    rdfs:domain geo:Feature ;
    rdfs:range geo:Geometry ;    
    skos:prefLabel "has Default Geometry"@en ;
    skos:definition "The default geometry to be used in spatial calculations, 
                    usually the most detailed geometry."@en ; 
    rdfs:subPropertyOf geo:hasGeometry ;
.
----

GeoSPARQL does not restrict the cardinality of the <<prop-hasdefaultgeometry, has default geometry>> property. It is thus possible for a Feature to have more than one distinct default geometry or to have no default geometry. This situation does not result in a query processing error; SPARQL graph pattern matching simply proceeds as normal. Certain queries may, however, give logically inconsistent results. For example, if a Feature `my:f1` has two asserted default geometries, and those two geometries are disjoint polygons, the query below could return a non-zero count on a system supporting the GeoSPARQL Query Rewrite Extension (rule http://www.opengis.net/def/rule/geosparql/sfDisjoint[`geor:sfDisjoint`]).

[%unnumbered]
[source,sparql]
----
PREFIX geo: <http://www.opengis.net/ont/geosparql#>

SELECT (COUNT(*) AS ?cnt)
WHERE { :f1 geo:sfDisjoint :f1 }
----

Such cases are application-specific data modeling errors and are therefore outside of the scope of the GeoSPARQL specification. However, it is recommended that multiple geometries indicated with <<prop-hasdefaultgeometry, `hasDefaultGeometry`>> should be differentiated by `Geometry` class properties, perhaps relating to precision, SRS etc.

[[prop-hascentroid]]
==== hasBoundingBox

The property <<prop-hasboundingbox, `hasBoundingBox`>> is used to link a Feature with a simplified geometry-representation corresponding to the envelope of its geometry. Bounding-boxes are typically used in indexing and discovery.

[%unnumbered]
[source,turtle]
----
geo:hasBoundingBox 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
    rdfs:subPropertyOf geo:hasGeometry ;
    rdfs:domain geo:Feature ;      
    rdfs:range geo:Geometry ;    
    skos:prefLabel "has bounding box"@en ;
    skos:definition "The minimum or smallest bounding or enclosing box of a given Feature."@en ; 
    skos:scopeNote "The target is a geometry that defines a rectilinear region whose edges are 
                    aligned with the axes of the coordinate reference system, which exactly 
                    contains the geometry or Feature e.g. sf:Envelope"@en ;
.
----

GeoSPARQL does not restrict the cardinality of the <<prop-hasboundingbox, `hasBoundingBox`>> property. A Feature may be associated with more than one bounding-box, for example in different coordinate reference systems.

[[prop-hasboundingbox]]
==== hasCentroid

The property http://www.opengis.net/ont/geosparql#hasCentroid[`hasCentroid`] is used to link a Feature with a point geometry corresponding with the centroid of its geometry. The centroid is typically used to show location on a low-resolution image, and for some indexing and discovery functions. 

[%unnumbered]
[source,turtle]
----
geo:hasCentroid 
    a rdf:Property, owl:ObjectProperty ;
    rdfs:isDefinedBy geo: ;
    rdfs:subPropertyOf geo:hasGeometry ;
    rdfs:domain geo:Feature ;     
    rdfs:range geo:Geometry ;    
    skos:prefLabel "has centroid"@en ;
    skos:definition "The arithmetic mean position of all the geometry points 
                    of a given Feature."@en ; 
    skos:scopeNote "The target geometry shall describe a point, e.g. sf:Point"@en ;
.
----

GeoSPARQL does not restrict the cardinality of the <<prop-hascentroid, `hasCentroid`>> property. A Feature may be associated with more than one centroid, for example computed using different rules or in different coordinate reference systems.
